services:
  workbench:
    container_name: carpentries-workbench
    image: carpentries/workbench-docker:${TAG:-latest}
    build:
      context: .
      dockerfile: Dockerfile
      args:
        SANDPAPER_VER: ${SANDPAPER_VER}
        VARNISH_VER: ${VARNISH_VER}
        PEGBOARD_VER: ${PEGBOARD_VER}
    volumes:
      - ${LESSON_PATH:-./lessons}:/home/rstudio/lesson # Mount local lessons directory
      - ./workbench-config:/home/rstudio/.workbench # Mount custom configurations
    env_file:
      - .env

  workbench-rmd:
    image: carpentries/workbench-docker:${TAG:-latest}
    container_name: carpentries-workbench-rmd
    build:
      context: .
      dockerfile: Dockerfile-renv
    volumes:
      - ${LESSON_PATH:-./lessons}:/home/rstudio/lesson # Mount local lessons directory
    env_file:
      - .env

  rstudio:
    image: carpentries/workbench-docker:${TAG:-latest}
    container_name: carpentries-workbench-rstudio
    volumes:
      - ${LESSON_PATH:-./lessons}:/home/rstudio/lesson # Mount local lessons directory
    ports:
      - "8787:8787"
    env_file:
      - .env
    restart: unless-stopped

volumes:
  workbench-config:
    driver: local
